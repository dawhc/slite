 ## 遇到的问题

---

1. 服务端调用`netstat -ano`发现大量的套接字处于CLOSE_WAIT状态

   > epoll ET模式下accept存在的问题
   > 考虑这种情况：多个连接同时到达，服务器的TCP就绪队列瞬间积累多个就绪连接，由于是边缘触发模式，epoll只会通知一次，accept只处理一个连接，导致TCP就绪队列中剩下的连接都得不到处理。
   >
   > 解决办法: 用while循环抱住accept调用，处理完TCP就绪队列中的所有连接后再退出循环。如何知道是否处理完就绪队列中的所有连接呢？accept返回-1并且errno设置为EAGAIN就表示所有连接都处理完。

2. 客户端突然断开连接导致服务端socket收到`SIGPIPE`信号

3. 服务端无法完全接收到POST请求体
